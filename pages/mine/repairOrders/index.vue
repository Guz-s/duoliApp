<script>
export default {
  name: "RepairOrders",
  data() {
    return {
      currentTab: 0,
      tabList: [
        { name: 'å·²ç”³è¯·(4)' },
        { name: 'å¾…å¤„ç†(3)' },
        { name: 'å¤„ç†ä¸­(2)' },
        { name: 'å·²å®Œæˆ(5)' },
        { name: 'å·²å–æ¶ˆ(1)' }
      ],
      orders: {
        applied: [
          {
            id: 101,
            orderNo: 'A20241225001',
            title: 'JUKI DDL-8700 æ–­çº¿æ•…éšœ',
            reporter: 'å¼ ä¸‰',
            phone: '13800138001',
            department: 'ä¸€è½¦é—´ç¼åˆ¶çº¿Aç»„',
            location: '3å·å‚æˆ¿ 2æ¥¼ è®¾å¤‡åŒº',
            equipmentModel: 'JUKI DDL-8700',
            faultLevel: 'ç´§æ€¥',
            faultDescription: 'è®¾å¤‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é¢‘ç¹æ–­çº¿ï¼Œå½±å“ç”Ÿäº§æ•ˆç‡ï¼Œéœ€è¦å°½å¿«å¤„ç†',
            createTime: '2024-12-25 14:30',
            images: ['/static/images/banner/duolidamen.png'],
            otherSeverity: ''
          },
          {
            id: 102,
            orderNo: 'A20241224002',
            title: 'å…„å¼Ÿç‰Œç¼çº«æœºå¼‚å“',
            reporter: 'æå››',
            phone: '13800138002',
            department: 'äºŒè½¦é—´ç¼åˆ¶çº¿Bç»„',
            location: '1å·å‚æˆ¿ 1æ¥¼ Aç»„',
            equipmentModel: 'å…„å¼Ÿç‰Œç¼çº«æœº',
            faultLevel: 'è¾ƒæ€¥',
            faultDescription: 'æœºå™¨è¿è¡Œæ—¶å‘å‡ºå¼‚å¸¸å™ªéŸ³ï¼Œéœ€è¦æ£€æŸ¥ç»´ä¿®',
            createTime: '2024-12-24 10:20',
            images: ['/static/images/banner/TORAYLogo.jpg'],
            otherSeverity: ''
          },
          {
            id: 103,
            orderNo: 'A20241223003',
            title: 'é‡æœºç¼çº«æœºå¡çº¿',
            reporter: 'ç‹äº”',
            phone: '13800138003',
            department: 'ä¸‰è½¦é—´ç¼åˆ¶çº¿Cç»„',
            location: '2å·å‚æˆ¿ 3æ¥¼ Bç»„',
            equipmentModel: 'é‡æœºç¼çº«æœº',
            faultLevel: 'ä¸€èˆ¬',
            faultDescription: 'ç¼çº«æœºç»å¸¸å¡çº¿ï¼Œå·²å½±å“æ­£å¸¸ç”Ÿäº§è¿›åº¦',
            createTime: '2024-12-23 16:45',
            images: [],
            otherSeverity: ''
          },
          {
            id: 104,
            orderNo: 'A20241222004',
            title: 'é£é©¬ç¼çº«æœºè·³çº¿',
            reporter: 'èµµå…­',
            phone: '13800138004',
            department: 'å››è½¦é—´ç¼åˆ¶çº¿Dç»„',
            location: '3å·å‚æˆ¿ 1æ¥¼ Cç»„',
            equipmentModel: 'é£é©¬ç¼çº«æœº',
            faultLevel: 'å…¶ä»–',
            faultDescription: 'ç¼çº«æœºè·³çº¿é—®é¢˜ï¼Œéœ€è¦ä¸“ä¸šæŠ€æœ¯äººå‘˜æ£€æŸ¥',
            createTime: '2024-12-22 09:15',
            images: [],
            otherSeverity: 'éœ€è¦æ›´æ¢ä¸“ç”¨é…ä»¶'
          }
        ],
        pending: [
          {
            id: 1,
            orderNo: 'R20241225001',
            title: 'JUKI DDL-8700 æ–­çº¿æ•…éšœ',
            location: '3å·å‚æˆ¿ 2æ¥¼ è®¾å¤‡åŒº',
            equipmentModel: 'JUKI DDL-8700',
            faultLevel: 'ç´§æ€¥',
            faultDescription: 'è®¾å¤‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é¢‘ç¹æ–­çº¿ï¼Œå½±å“ç”Ÿäº§æ•ˆç‡',
            createTime: '2024-12-25 14:30',
            images: ['/static/images/banner/duolidamen.png']
          },
          {
            id: 2,
            orderNo: 'R20241224002',
            title: 'å…„å¼Ÿç‰Œç¼çº«æœºå¼‚å“',
            location: '1å·å‚æˆ¿ 1æ¥¼ Aç»„',
            equipmentModel: 'å…„å¼Ÿç‰Œç¼çº«æœº',
            faultLevel: 'è¾ƒæ€¥',
            faultDescription: 'æœºå™¨è¿è¡Œæ—¶å‘å‡ºå¼‚å¸¸å™ªéŸ³ï¼Œéœ€è¦æ£€æŸ¥',
            createTime: '2024-12-24 10:20',
            images: ['/static/images/banner/TORAYLogo.jpg']
          },
          {
            id: 3,
            orderNo: 'R20241223003',
            title: 'é‡æœºç¼çº«æœºå¡çº¿',
            location: '2å·å‚æˆ¿ 3æ¥¼ Bç»„',
            equipmentModel: 'é‡æœºç¼çº«æœº',
            faultLevel: 'ä¸€èˆ¬',
            faultDescription: 'ç¼çº«æœºç»å¸¸å¡çº¿ï¼Œå·²å½±å“æ­£å¸¸ç”Ÿäº§',
            createTime: '2024-12-23 16:45',
            images: []
          }
        ],
        processing: [
          {
            id: 4,
            orderNo: 'R20241222001',
            title: 'é£é©¬ç¼çº«æœºè·³çº¿',
            location: '3å·å‚æˆ¿ 1æ¥¼ Cç»„',
            equipmentModel: 'é£é©¬ç¼çº«æœº',
            faultLevel: 'ç´§æ€¥',
            faultDescription: 'ç¼çº«æœºè·³çº¿ä¸¥é‡ï¼Œæ— æ³•æ­£å¸¸ç¼åˆ¶',
            createTime: '2024-12-22 09:15',
            images: []
          },
          {
            id: 5,
            orderNo: 'R20241221002',
            title: 'æ°å…‹ç¼çº«æœºå™ªéŸ³',
            location: '2å·å‚æˆ¿ 2æ¥¼ Bç»„',
            equipmentModel: 'æ°å…‹ç¼çº«æœº',
            faultLevel: 'è¾ƒæ€¥',
            faultDescription: 'è®¾å¤‡è¿è¡Œæ—¶å™ªéŸ³å¼‚å¸¸ï¼Œéœ€è¦ç»´ä¿®',
            createTime: '2024-12-21 15:30',
            images: []
          }
        ],
        completed: [
          {
            id: 6,
            orderNo: 'R20241220001',
            title: 'é‡æœºé”çœ¼æœºæ•…éšœ',
            location: '1å·å‚æˆ¿ 3æ¥¼ Aç»„',
            equipmentModel: 'é‡æœºé”çœ¼æœº',
            faultLevel: 'ä¸€èˆ¬',
            faultDescription: 'é”çœ¼æœºæ— æ³•æ­£å¸¸å·¥ä½œ',
            createTime: '2024-12-20 11:20',
            completeTime: '2024-12-20 16:45',
            images: []
          },
          {
            id: 7,
            orderNo: 'R20241219002',
            title: 'JUKIåŒ…ç¼æœºæ–­çº¿',
            location: '3å·å‚æˆ¿ 2æ¥¼ Dç»„',
            equipmentModel: 'JUKIåŒ…ç¼æœº',
            faultLevel: 'ç´§æ€¥',
            faultDescription: 'åŒ…ç¼æœºé¢‘ç¹æ–­çº¿ï¼Œå½±å“ç”Ÿäº§',
            createTime: '2024-12-19 14:10',
            completeTime: '2024-12-19 18:30',
            images: []
          },
          {
            id: 8,
            orderNo: 'R20241218003',
            title: 'å…„å¼Ÿç‰Œæ‹·è¾¹æœºå¼‚å“',
            location: '2å·å‚æˆ¿ 1æ¥¼ Cç»„',
            equipmentModel: 'å…„å¼Ÿç‰Œæ‹·è¾¹æœº',
            faultLevel: 'è¾ƒæ€¥',
            faultDescription: 'æ‹·è¾¹æœºè¿è¡Œæ—¶å‘å‡ºå¼‚å¸¸å£°éŸ³',
            createTime: '2024-12-18 10:45',
            completeTime: '2024-12-18 15:20',
            images: []
          },
          {
            id: 9,
            orderNo: 'R20241217004',
            title: 'é£é©¬å¹³ç¼æœºå¡çº¿',
            location: '1å·å‚æˆ¿ 2æ¥¼ Bç»„',
            equipmentModel: 'é£é©¬å¹³ç¼æœº',
            faultLevel: 'ä¸€èˆ¬',
            faultDescription: 'å¹³ç¼æœºç»å¸¸å¡çº¿ï¼Œéœ€è¦è°ƒæ•´',
            createTime: '2024-12-17 16:30',
            completeTime: '2024-12-17 20:15',
            images: []
          },
          {
            id: 10,
            orderNo: 'R20241216005',
            title: 'æ°å…‹ç»·ç¼æœºè·³çº¿',
            location: '3å·å‚æˆ¿ 3æ¥¼ Aç»„',
            equipmentModel: 'æ°å…‹ç»·ç¼æœº',
            faultLevel: 'è¾ƒæ€¥',
            faultDescription: 'ç»·ç¼æœºè·³çº¿é—®é¢˜ï¼Œå½±å“è´¨é‡',
            createTime: '2024-12-16 13:25',
            completeTime: '2024-12-16 17:40',
            images: []
          }
        ],
        cancelled: [
          {
            id: 11,
            orderNo: 'R20241215001',
            title: 'é‡æœºé’‰æ‰£æœºæ•…éšœ',
            location: '2å·å‚æˆ¿ 3æ¥¼ Dç»„',
            equipmentModel: 'é‡æœºé’‰æ‰£æœº',
            faultLevel: 'ä¸€èˆ¬',
            faultDescription: 'é’‰æ‰£æœºæ— æ³•æ­£å¸¸å·¥ä½œ',
            createTime: '2024-12-15 09:30',
            cancelTime: '2024-12-15 10:15',
            cancelReason: 'è®¾å¤‡å·²æ›´æ¢ï¼Œæ— éœ€ç»´ä¿®',
            images: []
          }
        ]
      }
    }
  },
  computed: {
    currentOrders() {
      const statusMap = ['applied', 'pending', 'processing', 'completed', 'cancelled']
      return this.orders[statusMap[this.currentTab]] || []
    },
    tabLineLeft() {
      // 5ä¸ªæ ‡ç­¾é¡µï¼Œæ¯ä¸ªæ ‡ç­¾é¡µå®½åº¦ä¸º 100% / 5 = 20%
      // ä»¥rpxä¸ºå•ä½ï¼Œå±å¹•å®½åº¦750rpxï¼Œæ¯ä¸ªæ ‡ç­¾å®½åº¦150rpx
      const tabWidth = 750 / 5 // 150rpx
      const lineWidth = 60 // ä¸‹åˆ’çº¿å®½åº¦60rpx
      const offset = (tabWidth - lineWidth) / 2 // å±…ä¸­åç§»é‡
      return (this.currentTab * tabWidth) + offset
    },
    tabLineWidth() {
      return 60 // ä¸‹åˆ’çº¿å®½åº¦
    }
  },
  methods: {
    // é€‰é¡¹å¡åˆ‡æ¢
    tabChange(index) {
      this.currentTab = index
    },
    // æŸ¥çœ‹å·¥å•è¯¦æƒ…
    viewOrderDetail(order) {
      // å¦‚æœæ˜¯å·²ç”³è¯·çŠ¶æ€ï¼Œè·³è½¬åˆ°ç¼–è¾‘é¡µé¢
      if (this.currentTab === 0) {
        this.editApplication(order)
        return
      }
      
      uni.showModal({
        title: 'å·¥å•è¯¦æƒ…',
        content: `å·¥å•å·ï¼š${order.orderNo}\nçŠ¶æ€ï¼š${this.getStatusText(this.currentTab)}\næè¿°ï¼š${order.faultDescription}`,
        showCancel: false
      })
    },
    // ç¼–è¾‘ç”³è¯·
    editApplication(order) {
      // å°†ç”³è¯·æ•°æ®å­˜å‚¨åˆ°å…¨å±€å˜é‡æˆ–æœ¬åœ°å­˜å‚¨ï¼Œä¾›ç¼–è¾‘é¡µé¢ä½¿ç”¨
      uni.setStorageSync('editingOrder', order)
      
      // è·³è½¬åˆ°æŠ¥ä¿®ç”³è¯·é¡µé¢è¿›è¡Œç¼–è¾‘
      uni.navigateTo({
        url: '/pages/work/carWarranty/index?mode=edit&id=' + order.id
      })
    },
    // è·å–çŠ¶æ€æ–‡æœ¬
    getStatusText(statusIndex) {
      const statusMap = ['å·²ç”³è¯·', 'å¾…å¤„ç†', 'å¤„ç†ä¸­', 'å·²å®Œæˆ', 'å·²å–æ¶ˆ']
      return statusMap[statusIndex] || 'æœªçŸ¥'
    },
    // é¢„è§ˆå›¾ç‰‡
    previewImages(images, current) {
      if (!images || images.length === 0) return
      uni.previewImage({
        current,
        urls: images
      })
    },
    // è·å–æ•…éšœç­‰çº§é¢œè‰²
    getFaultLevelColor(level) {
      const colorMap = {
        'ç´§æ€¥': '#ff4757',
        'è¾ƒæ€¥': '#ffa502',
        'ä¸€èˆ¬': '#2ed573'
      }
      return colorMap[level] || '#666'
    }
  }
}
</script>

<template>
  <view class="page">
    <!-- çŠ¶æ€é€‰é¡¹å¡ -->
    <view class="tabs-container">
      <view class="tabs-wrapper">
        <view 
          class="tab-item" 
          v-for="(tab, index) in tabList" 
          :key="index"
          :class="{ 'active': currentTab === index }"
          @click="tabChange(index)"
        >
          <text class="tab-text">{{ tab.name }}</text>
        </view>
      </view>
      <view class="tab-line" :style="{ left: tabLineLeft + 'rpx', width: tabLineWidth + 'rpx' }"></view>
    </view>

    <!-- å·¥å•åˆ—è¡¨ -->
    <view class="orders-container">
      <view class="orders-list" v-if="currentOrders.length > 0">
        <view 
          class="order-item" 
          v-for="order in currentOrders" 
          :key="order.id" 
          @click="viewOrderDetail(order)"
        >
          <view class="order-header">
            <text class="order-id">#{{ order.orderNo }}</text>
            <view class="order-status" :class="'status-' + currentTab">
              {{ getStatusText(currentTab) }}
            </view>
          </view>
          
          <view class="order-content">
            <text class="order-title">{{ order.title }}</text>
            <view class="order-info">
              <text class="info-item">ğŸ“ {{ order.location }}</text>
              <text class="info-item">ğŸ”§ {{ order.equipmentModel }}</text>
              <text class="info-item" :style="{ color: getFaultLevelColor(order.faultLevel) }">
                âš¡ {{ order.faultLevel }}
              </text>
            </view>
            <text class="order-desc">{{ order.faultDescription }}</text>
          </view>

          <view class="order-footer">
            <text class="order-time">{{ order.createTime }}</text>
            <view class="order-actions">
              <text class="action-text" v-if="currentTab === 0">ç‚¹å‡»ç¼–è¾‘</text>
              <text class="action-text" v-else-if="currentTab === 1">ç­‰å¾…å¤„ç†</text>
              <text class="action-text" v-else-if="currentTab === 2">ç»´ä¿®ä¸­</text>
              <text class="action-text" v-else-if="currentTab === 3">å·²å®Œæˆ</text>
              <text class="action-text" v-else>å·²å–æ¶ˆ</text>
            </view>
          </view>

          <!-- å›¾ç‰‡é¢„è§ˆ -->
          <view class="order-images" v-if="order.images && order.images.length > 0">
            <image 
              v-for="(img, index) in order.images.slice(0, 3)" 
              :key="index"
              :src="img" 
              class="preview-img"
              @click.stop="previewImages(order.images, index)"
            />
            <view class="more-images" v-if="order.images.length > 3">
              +{{ order.images.length - 3 }}
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" v-else>
        <u-empty 
          mode="data" 
          text="æš‚æ— æ•°æ®"
          :show="true"
        ></u-empty>
        <text class="empty-hint">è¯¥çŠ¶æ€ä¸‹æš‚æ— æŠ¥ä¿®è®°å½•</text>
      </view>
    </view>
  </view>
</template>

<style scoped lang="scss">
.page {
  min-height: 100vh;
  background: #f6f7fb;
}

.tabs-container {
  position: relative;
  background: #fff;
  border-bottom: 1px solid #eee;
}

.tabs-wrapper {
  display: flex;
  position: relative;
}

.tab-item {
  flex: 1;
  height: 88rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  transition: all 0.3s ease;

  .tab-text {
    font-size: 28rpx;
    color: #666;
    transition: all 0.3s ease;
  }

  &.active {
    .tab-text {
      color: #007AFF;
      font-weight: bold;
    }
  }
}

.tab-line {
  position: absolute;
  bottom: 0;
  height: 4rpx;
  background: #007AFF;
  border-radius: 2rpx;
  transition: all 0.3s ease;
}

.orders-container {
  padding: 20rpx;
  height: calc(100vh - 100rpx);
  overflow-y: auto;
}


.orders-list {
  .order-item {
    background: #fff;
    border-radius: 16rpx;
    padding: 32rpx;
    margin-bottom: 20rpx;
    box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24rpx;

      .order-id {
        font-size: 28rpx;
        font-weight: 600;
        color: #333;
      }

      .order-status {
        padding: 8rpx 16rpx;
        border-radius: 20rpx;
        font-size: 20rpx;
        color: #fff;

        &.status-0 {
          background: #5856D6;
        }

        &.status-1 {
          background: #FF9500;
        }

        &.status-2 {
          background: #007AFF;
        }

        &.status-3 {
          background: #34C759;
        }

        &.status-4 {
          background: #8E8E93;
        }
      }
    }

    .order-content {
      margin-bottom: 24rpx;

      .order-title {
        display: block;
        font-size: 30rpx;
        font-weight: 600;
        color: #333;
        margin-bottom: 16rpx;
      }

      .order-info {
        margin-bottom: 16rpx;

        .info-item {
          display: block;
          font-size: 24rpx;
          color: #666;
          margin-bottom: 8rpx;
        }
      }

      .order-desc {
        font-size: 26rpx;
        color: #333;
        line-height: 1.5;
      }
    }

    .order-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;

      .order-time {
        font-size: 22rpx;
        color: #999;
      }

      .order-actions {
        .action-text {
          font-size: 22rpx;
          color: #007AFF;
        }
      }
    }

    .order-images {
      display: flex;
      gap: 16rpx;
      margin-top: 24rpx;

      .preview-img {
        width: 120rpx;
        height: 120rpx;
        border-radius: 12rpx;
      }

      .more-images {
        width: 120rpx;
        height: 120rpx;
        background: #f0f0f0;
        border-radius: 12rpx;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24rpx;
        color: #666;
      }
    }
  }
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 120rpx 40rpx;
  text-align: center;

  .empty-hint {
    margin-top: 24rpx;
    font-size: 24rpx;
    color: #999;
  }
}
</style>
